<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ask Krshn - Bhagavad Gita Chatbot</title>
    <style>
        :root {
            --primary-color: #FF9800;
            --primary-dark: #F57C00;
            --primary-light: #FFE0B2;
            --secondary-color: #FFFFFF;
            --text-color: #333333;
            --light-text: #666666;
            --border-color: #E0E0E0;
            --success-color: #4CAF50;
            --error-color: #F44336;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f9f9f9;
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 600;
        }

        .logo-icon {
            font-size: 2rem;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 20px;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 4px;
            transition: background-color 0.3s;
            cursor: pointer;
        }

        nav a:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .hero {
            text-align: center;
            padding: 3rem 0;
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--secondary-color) 100%);
        }

        .hero h2 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--primary-dark);
        }

        .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 2rem;
            color: var(--light-text);
        }

        .chat-container {
            max-width: 800px;
            margin: 0 auto 3rem;
            background-color: var(--secondary-color);
            border-radius: 10px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .chat-header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
            text-align: center;
        }

        .chat-messages {
            height: 400px;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            align-self: flex-end;
            background-color: var(--primary-light);
            border-bottom-right-radius: 4px;
        }

        .bot-message {
            align-self: flex-start;
            background-color: #f0f0f0;
            border-bottom-left-radius: 4px;
        }

        .message-meta {
            font-size: 0.75rem;
            color: var(--light-text);
            margin-top: 5px;
        }

        .chat-input-container {
            display: flex;
            padding: 1rem;
            border-top: 1px solid var(--border-color);
            background-color: var(--secondary-color);
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 24px;
            outline: none;
            font-size: 1rem;
        }

        .chat-input:focus {
            border-color: var(--primary-color);
        }

        .send-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            margin-left: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }

        .send-button:hover {
            background-color: var(--primary-dark);
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 2rem;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 24px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .btn-secondary:hover {
            background-color: var(--primary-light);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: var(--secondary-color);
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            padding: 2rem;
            box-shadow: var(--shadow);
            position: relative;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            color: var(--primary-dark);
        }

        .close-button {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--light-text);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .qr-code {
            text-align: center;
            margin: 1.5rem 0;
        }

        .qr-code img {
            max-width: 100%;
            height: auto;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }

        footer {
            background-color: var(--primary-dark);
            color: white;
            text-align: center;
            padding: 2rem 0;
            margin-top: 3rem;
        }

        .footer-content {
            max-width: 700px;
            margin: 0 auto;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 1rem 0;
        }

        .footer-links a {
            color: white;
            text-decoration: none;
        }

        .footer-links a:hover {
            text-decoration: underline;
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 10px;
            }

            nav ul {
                gap: 10px;
            }

            .hero h2 {
                font-size: 2rem;
            }

            .hero p {
                font-size: 1rem;
            }

            .message {
                max-width: 90%;
            }

            .action-buttons {
                flex-direction: column;
                align-items: center;
            }

            .btn {
                width: 100%;
                max-width: 250px;
                justify-content: center;
            }
        }

        /* Loading animation */
        .typing-indicator {
            display: inline-block;
            background-color: #f0f0f0;
            padding: 12px 16px;
            border-radius: 18px;
            border-bottom-left-radius: 4px;
            align-self: flex-start;
        }

        .typing-indicator span {
            height: 8px;
            width: 8px;
            background-color: var(--light-text);
            border-radius: 50%;
            display: inline-block;
            margin: 0 2px;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-indicator span:nth-child(1) {
            animation-delay: 0s;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-5px);
            }
        }

        /* Navigation Modal Styles */
        .nav-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .nav-modal-content {
            background-color: var(--secondary-color);
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 2rem;
            box-shadow: var(--shadow);
            position: relative;
            animation: slideUp 0.3s ease;
        }

        .nav-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--primary-light);
            padding-bottom: 1rem;
        }

        .nav-modal-title {
            font-size: 1.8rem;
            color: var(--primary-dark);
            margin: 0;
        }

        .close-nav-modal {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--light-text);
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.3s;
        }

        .close-nav-modal:hover {
            background-color: var(--primary-light);
        }

        /* About page styles */
        .about-content {
            line-height: 1.8;
        }

        .about-features {
            margin: 1.5rem 0;
        }

        .feature-item {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            padding: 10px;
            background-color: var(--primary-light);
            border-radius: 8px;
        }

        .feature-icon {
            font-size: 1.5rem;
            margin-right: 1rem;
            color: var(--primary-dark);
        }

        /* Chapters page styles */
        .chapters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin: 1.5rem 0;
        }

        .chapter-card {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 1.5rem 1rem;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: var(--shadow);
        }

        .chapter-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .chapter-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .chapter-title {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Contact page styles */
        .contact-info {
            text-align: center;
            margin: 2rem 0;
        }

        .contact-item {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 1.5rem 0;
            padding: 1rem;
            background-color: var(--primary-light);
            border-radius: 10px;
            transition: transform 0.3s;
        }

        .contact-item:hover {
            transform: translateX(10px);
        }

        .contact-icon {
            font-size: 2rem;
            margin-right: 1rem;
            color: var(--primary-dark);
        }

        .contact-details {
            text-align: left;
        }

        .contact-label {
            font-weight: bold;
            color: var(--primary-dark);
            margin-bottom: 0.25rem;
        }

        .contact-value {
            color: var(--text-color);
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
        }

        .social-link {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border-radius: 50%;
            text-decoration: none;
            font-size: 1.5rem;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .social-link:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        /* Install prompt styles */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary-color);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
            z-index: 1000;
            animation: slideInRight 0.5s ease;
            display: none;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .install-prompt-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .install-btn {
            background: white;
            color: var(--primary-color);
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .install-btn:hover {
            transform: scale(1.05);
        }

        .close-install {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
        }

        /* Bot Message Format Styles */
        .bot-reply-container {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .user-question {
            font-style: italic;
            color: #666;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }

        .verse-reference {
            font-weight: bold;
            color: var(--primary-dark);
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .shlok-text {
            font-style: italic;
            color: #333;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f9f9f9;
            border-left: 3px solid var(--primary-color);
            border-radius: 5px;
        }

        .guidance-title {
            font-weight: bold;
            color: var(--primary-dark);
            margin-bottom: 5px;
        }

        .guidance-text {
            color: #555;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-icon">üïâÔ∏è</span>
                    <h1>Ask Krshn</h1>
                </div>
                <nav>
                    <ul>
                        <li><a href="#" id="aboutLink">About</a></li>
                        <li><a href="#" id="chaptersLink">Chapters</a></li>
                        <li><a href="#" id="contactLink">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- Navigation Modals -->
    <div class="nav-modal" id="aboutModal">
        <div class="nav-modal-content">
            <div class="nav-modal-header">
                <h3 class="nav-modal-title">About Ask Krshn</h3>
                <button class="close-nav-modal" data-modal="aboutModal">&times;</button>
            </div>
            <div class="about-content">
                <p><strong>Ask Krshn</strong> is a divine chatbot that brings the eternal wisdom of the Bhagavad Gita to your fingertips. Our mission is to make the sacred teachings of Lord Krishna accessible to everyone, everywhere.</p>
                
                <div class="about-features">
                    <div class="feature-item">
                        <span class="feature-icon">üïâÔ∏è</span>
                        <div>
                            <strong>Authentic Wisdom</strong><br>
                            Direct from the 700 verses of Bhagavad Gita
                        </div>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">üí¨</span>
                        <div>
                            <strong>Intelligent Responses</strong><br>
                            Advanced matching for relevant answers
                        </div>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">üì±</span>
                        <div>
                            <strong>Always Available</strong><br>
                            Works offline after installation
                        </div>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">üåç</span>
                        <div>
                            <strong>Multi-language Support</strong><br>
                            Understands and responds in your language
                        </div>
                    </div>
                </div>

                <p><strong>Version:</strong> 1.0.0</p>
                <p><strong>Developed with:</strong> ‚ù§Ô∏è for spiritual seekers worldwide</p>
            </div>
        </div>
    </div>

    <div class="nav-modal" id="chaptersModal">
        <div class="nav-modal-content">
            <div class="nav-modal-header">
                <h3 class="nav-modal-title">Bhagavad Gita Chapters</h3>
                <button class="close-nav-modal" data-modal="chaptersModal">&times;</button>
            </div>
            <div class="chapters-content">
                <p>Explore the 18 chapters of Bhagavad Gita. Each chapter contains divine wisdom about life, duty, and spirituality.</p>
                
                <div class="chapters-grid" id="chaptersGrid">
                    <!-- Chapters will be dynamically generated -->
                </div>
            </div>
        </div>
    </div>

    <div class="nav-modal" id="contactModal">
        <div class="nav-modal-content">
            <div class="nav-modal-header">
                <h3 class="nav-modal-title">Contact Us</h3>
                <button class="close-nav-modal" data-modal="contactModal">&times;</button>
            </div>
            <div class="contact-content">
                <p>We'd love to hear from you! Get in touch with us through any of the following ways:</p>
                
                <div class="contact-info">
                    <div class="contact-item">
                        <span class="contact-icon">üìß</span>
                        <div class="contact-details">
                            <div class="contact-label">Email</div>
                            <div class="contact-value">pramanickrudra74@gmail.com</div>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <span class="contact-icon">üì±</span>
                        <div class="contact-details">
                            <div class="contact-label">Instagram</div>
                            <div class="contact-value">@rudra_._8</div>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <span class="contact-icon">üí¨</span>
                        <div class="contact-details">
                            <div class="contact-label">Feedback</div>
                            <div class="contact-value">Use the feedback button in the app</div>
                        </div>
                    </div>
                </div>

                <div class="social-links">
                    <a href="mailto:pramanickrudra74@gmail.com" class="social-link" title="Email">
                        üìß
                    </a>
                    <a href="https://instagram.com/rudra_._8" class="social-link" title="Instagram">
                        üì∑
                    </a>
                    <a href="#" class="social-link" title="WhatsApp" onclick="shareOnWhatsApp()">
                        üí¨
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Install Prompt -->
    <div class="install-prompt" id="installPrompt">
        <div class="install-prompt-content">
            <span>Install Ask Krshn for better experience</span>
            <button class="install-btn" id="installButton">Install</button>
            <button class="close-install" id="closeInstall">&times;</button>
        </div>
    </div>

    <section class="hero">
        <div class="container">
            <h2>Discover the Wisdom of Bhagavad Gita</h2>
            <p>Pranamil Ask me any question about life, Minn Abhe Hindi Bolna Sikh Raha Hu, Ap Mujhe Ko! Prashn Puchige üòä.</p>
        </div>
    </section>

    <section class="chat-section">
        <div class="container">
            <div class="chat-container">
                <div class="chat-header">
                    <h3>Chat with Krshn</h3>
                </div>
                <div class="chat-messages" id="chatMessages">
                    <div class="message bot-message">
                        <div class="bot-reply-container">
                            <div class="verse-reference"> PRANAAMüôèüå∏:</div>
                            <div class="shlok-text"> Kripya Apna Prashn Puchiye , Main Bhagwat Gita Ke Anushar Uttar Dene Ka Prayash Karunga </div>
                        </div>
                        <div class="message-meta">Krshn ‚Ä¢ Just now</div>
                    </div>
                </div>
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="userInput" placeholder="Type your question here...">
                    <button class="send-button" id="sendButton">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2 21L23 12L2 3V10L17 12L2 14V21Z" fill="white"/>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" id="donateButton">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 5.5V7H9V5.5L3 7V9L9 10.5V12L3 13.5V15.5L9 14V16L3 17.5V19.5L9 18V22H15V18L21 19.5V17.5L15 16V14L21 15.5V13.5L15 12V10.5L21 9Z" fill="white"/>
                    </svg>
                    Donate
                </button>
                <button class="btn btn-secondary" id="feedbackButton">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20 2H4C2.9 2 2 2.9 2 4V22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2ZM20 16H5.17L4 17.17V4H20V16ZM7 9H9V11H7V9ZM15 9H17V11H15V9ZM11 9H13V11H11V9Z" fill="#FF9800"/>
                    </svg>
                    Feedback
                </button>
                <button class="btn btn-secondary" id="pdfButton">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M19 9H15V3H9V9H5L12 16L19 9ZM5 18V20H19V18H5Z" fill="#FF9800"/>
                    </svg>
                    Download PDF
                </button>
            </div>
        </div>
    </section>

    <!-- Donate Modal -->
    <div class="modal" id="donateModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Support Our Mission</h3>
                <button class="close-button" id="closeDonateModal">&times;</button>
            </div>
            <p>Your donation helps us maintain and improve this service to spread the wisdom of Bhagavad Gita to more people.</p>
            <div class="qr-code">
                <img src="https://i.postimg.cc/T2N60PKJ/Google-Pay-QR.png">
            </div>
            <p style="text-align: center; font-weight: 500;">Scan to donate via UPI Or ID - pramanickrudra74@oksbi</p>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div class="modal" id="feedbackModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Share Your Feedback</h3>
                <button class="close-button" id="closeFeedbackModal">&times;</button>
            </div>
            <form id="feedbackForm">
                <div class="form-group">
                    <label for="feedbackEmail" class="form-label">Email Address</label>
                    <input type="email" class="form-control" id="feedbackEmail" placeholder="Your email (optional)">
                </div>
                <div class="form-group">
                    <label for="feedbackMessage" class="form-label">Your Feedback</label>
                    <textarea class="form-control" id="feedbackMessage" rows="4" placeholder="Share your thoughts, suggestions, or issues..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Submit Feedback</button>
            </form>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <p>Ask Krshn - Bhagavad Gita Chatbot</p>
                <div class="footer-links">
                    <a href="#privacy">Privacy Policy</a>
                    <a href="#terms">Terms of Service</a>
                    <a href="admin.html">Admin Panel</a>
                </div>
                <p>&copy; 2025 Ask Krshn. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDummyKeyForExampleOnly",
            authDomain: "ask-krshn.firebaseapp.com",
            databaseURL: "https://ask-krshn-default-rtdb.firebaseio.com",
            projectId: "ask-krshn",
            storageBucket: "ask-krshn.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef123456"
        };

        // Initialize Firebase (commented out for demo)
        // firebase.initializeApp(firebaseConfig);
        // const database = firebase.database();

        // DOM Elements
        const chatMessages = document.getElementById('chatMessages');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        const donateButton = document.getElementById('donateButton');
        const feedbackButton = document.getElementById('feedbackButton');
        const pdfButton = document.getElementById('pdfButton');
        const donateModal = document.getElementById('donateModal');
        const feedbackModal = document.getElementById('feedbackModal');
        const closeDonateModal = document.getElementById('closeDonateModal');
        const closeFeedbackModal = document.getElementById('closeFeedbackModal');
        const feedbackForm = document.getElementById('feedbackForm');
        const donateQrImage = document.getElementById('donateQrImage');

        // Sample data for demonstration (in a real app, this would come from Firebase)
        const sampleData = {
            shloks: {
                chapter_1: {
                    verse_1: {
                        shlok: "Dhritarashtra said: O Sanjaya, assembled on the sacred plain of Kurukshetra, what did my sons and the sons of Pandu do, desiring to fight?",
                        explanation: "The first verse of the Bhagavad Gita introduces the setting and the anxious inquiry of King Dhritarashtra about the battle between his sons and the Pandavas."
                    },
                    verse_2: {
                        shlok: "Sanjaya said: O King, after looking over the army arranged in military formation by the sons of Pandu, King Duryodhana went to his teacher and spoke the following words.",
                        explanation: "Sanjaya begins his narration by describing Duryodhana's approach to his teacher Dronacharya upon seeing the Pandava army formation."
                    }
                },
                chapter_2: {
                    verse_47: {
                        shlok: "You have the right to perform your duties, but not the right to the fruits of your actions. Do your work without attachment to results.",
                        explanation: "Focus on performing your duties with dedication and sincerity, without being attached to the outcomes or results. The results are not in your control, but your efforts are."
                    },
                    verse_1: {
                        shlok: "Sanjaya said: To him who had thus been overcome with pity, whose eyes were filled with tears and troubled, and who was despondent, the Destroyer of Madhu (Krishna) spoke these words.",
                        explanation: "At the beginning of Chapter 2, Lord Krishna notices Arjuna's despondency and begins to impart spiritual wisdom to guide him."
                    },
                    verse_2: {
                        shlok: "The Supreme Lord said: My dear Arjuna, how have these impurities come upon you? They are not at all befitting a man who knows the progressive values of life. They do not lead to higher planets, but to infamy.",
                        explanation: "Lord Krishna questions Arjuna's sudden weakness, pointing out that such despondency is unbecoming of a noble warrior and leads only to disgrace."
                    }
                },
                chapter_3: {
                    verse_8: {
                        shlok: "Perform your prescribed duties, for action is better than inaction. Even the maintenance of your body would not be possible without action.",
                        explanation: "Action is essential for life and spiritual progress. One should perform their duties rather than avoiding them."
                    }
                },
                chapter_4: {
                    verse_18: {
                        shlok: "One who sees inaction in action, and action in inaction, is intelligent among men, and he is in the transcendental position, although engaged in all sorts of activities.",
                        explanation: "The wise understand the nature of action and inaction, performing duties without attachment to results."
                    }
                }
            },
            greetings: {
                greeting_1: {
                    trigger: "Radhe Radhe",
                    reply: "Radhe Radhe! May your heart be filled with divine love and your path be illuminated by spiritual wisdom."
                },
                greeting_2: {
                    trigger: "Hare Krishna",
                    reply: "Hare Krishna! Welcome, dear soul. May the holy names bring peace and enlightenment to your life."
                },
                greeting_3: {
                    trigger: "Jai Shri Krishna",
                    reply: "Jai Shri Krishna! All glories to Lord Krishna. May His divine grace guide you on your spiritual journey."
                },
                greeting_4: {
                    trigger: "Pranam",
                    reply: "Pranam! üôè Welcome, seeker of truth. I am Krshn, here to guide you through the eternal wisdom of Bhagavad Gita. Ask me anything about life, duty, or spirituality."
                },
                greeting_5: {
                    trigger: "Hello",
                    reply: "Hello! üåü I'm Krshn, your guide to the divine wisdom of Bhagavad Gita. What would you like to know today?"
                },
                greeting_6: {
                    trigger: "Hi",
                    reply: "Hi there! üïâÔ∏è I'm Krshn, ready to share the timeless teachings of Bhagavad Gita with you. What's on your mind?"
                }
            },
            meta: {
                donateQrUrl: "https://i.postimg.cc/9M6K5J9r/donate-qr.png"
            }
        };

        // Common stop words for keyword extraction
        const stopWords = new Set([
            'a', 'an', 'the', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 'be', 'been', 'being',
            'have', 'has', 'had', 'do', 'does', 'did', 'will', 'would', 'could', 'should', 'may',
            'might', 'must', 'can', 'what', 'who', 'whom', 'whose', 'which', 'where', 'when', 'why',
            'how', 'all', 'any', 'both', 'each', 'few', 'more', 'most', 'other', 'some', 'such', 'no',
            'nor', 'not', 'only', 'own', 'same', 'so', 'than', 'too', 'very', 'just', 'now'
        ]);

        // Function to extract keywords from text
        function extractKeywords(text) {
            return text.toLowerCase()
                .replace(/[^\w\s]/g, '')
                .split(/\s+/)
                .filter(word => word.length > 2 && !stopWords.has(word));
        }

        // Function to calculate match score between question and shlok
        function calculateMatchScore(questionKeywords, shlokText) {
            const shlokKeywords = extractKeywords(shlokText);
            let score = 0;
            
            for (const keyword of questionKeywords) {
                if (shlokKeywords.some(shlokWord => shlokWord.includes(keyword) || keyword.includes(shlokWord))) {
                    score += 1;
                }
            }
            
            return score;
        }

        // Function to find the best matching shlok
        function findBestShlok(question) {
            const questionKeywords = extractKeywords(question);
            let bestScore = 0;
            let bestShlok = null;
            let bestChapter = null;
            let bestVerse = null;

            // First check for greetings
            for (const greetingId in sampleData.greetings) {
                const greeting = sampleData.greetings[greetingId];
                if (question.toLowerCase().includes(greeting.trigger.toLowerCase())) {
                    return {
                        type: 'greeting',
                        reply: greeting.reply
                    };
                }
            }

            // Then search through shloks
            for (const chapterKey in sampleData.shloks) {
                const chapter = sampleData.shloks[chapterKey];
                for (const verseKey in chapter) {
                    const verse = chapter[verseKey];
                    const score = calculateMatchScore(questionKeywords, verse.shlok + ' ' + verse.explanation);
                    
                    if (score > bestScore) {
                        bestScore = score;
                        bestShlok = verse;
                        bestChapter = chapterKey;
                        bestVerse = verseKey;
                    }
                }
            }

            if (bestScore > 0) {
                return {
                    type: 'shlok',
                    chapter: bestChapter,
                    verse: bestVerse,
                    shlok: bestShlok.shlok,
                    explanation: bestShlok.explanation
                };
            }

            return null;
        }

        // Function to format bot reply exactly like the image
        function formatBotReply(userQuestion, response) {
            if (response.type === 'greeting') {
                return response.reply;
            } else {
                const chapterNum = response.chapter.split('_')[1];
                const verseNum = response.verse.split('_')[1];
                
                return `
                    <div class="bot-reply-container">
                        <div class="user-question">You asked: "${userQuestion}"</div>
                        <div class="verse-reference">A relevant verse is found in Chapter ${chapterNum}, Verse ${verseNum}:</div>
                        <div class="shlok-text">"${response.shlok}"</div>
                        <div class="guidance-title">Guidance from this verse:</div>
                        <div class="guidance-text">${response.explanation}</div>
                    </div>
                `;
            }
        }

        // Function to add a message to the chat
        function addMessage(message, isUser = false, userQuestion = '') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
            
            if (isUser) {
                const messageContent = document.createElement('div');
                messageContent.textContent = message;
                messageDiv.appendChild(messageContent);
            } else {
                messageDiv.innerHTML = message;
            }
            
            const messageMeta = document.createElement('div');
            messageMeta.className = 'message-meta';
            messageMeta.textContent = isUser ? 'You ‚Ä¢ Just now' : 'Krshn ‚Ä¢ Just now';
            messageDiv.appendChild(messageMeta);
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Function to show typing indicator
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing-indicator';
            typingDiv.id = 'typingIndicator';
            
            const dots = document.createElement('div');
            dots.innerHTML = '<span></span><span></span><span></span>';
            typingDiv.appendChild(dots);
            
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            return typingDiv;
        }

        // Function to remove typing indicator
        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // Function to handle user message
        function handleUserMessage() {
            const message = userInput.value.trim();
            if (!message) return;
            
            addMessage(message, true);
            userInput.value = '';
            
            // Show typing indicator
            const typingIndicator = showTypingIndicator();
            
            // Simulate processing delay
            setTimeout(() => {
                removeTypingIndicator();
                
                const response = findBestShlok(message);
                
                if (response) {
                    if (response.type === 'greeting') {
                        addMessage(response.reply);
                    } else {
                        const formattedReply = formatBotReply(message, response);
                        addMessage(formattedReply, false, message);
                    }
                } else {
                    const noAnswerReply = `
                        <div class="bot-reply-container">
                            <div class="user-question">You asked: "${message}"</div>
                            <div class="guidance-text">I'm sorry, I couldn't find a specific answer to your question in the Bhagavad Gita. Please try rephrasing your question or ask about a different topic related to life, duty, karma, or spirituality.</div>
                        </div>
                    `;
                    addMessage(noAnswerReply);
                }
            }, 1500);
        }

        // Event Listeners for Chat
        sendButton.addEventListener('click', handleUserMessage);
        
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleUserMessage();
            }
        });

        donateButton.addEventListener('click', () => {
            donateModal.style.display = 'flex';
        });

        feedbackButton.addEventListener('click', () => {
            feedbackModal.style.display = 'flex';
        });

        closeDonateModal.addEventListener('click', () => {
            donateModal.style.display = 'none';
        });

        closeFeedbackModal.addEventListener('click', () => {
            feedbackModal.style.display = 'none';
        });

        pdfButton.addEventListener('click', () => {
            alert('PDF download functionality would be implemented here. In a real application, this would generate a PDF of the conversation.');
        });

        feedbackForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('feedbackEmail').value;
            const message = document.getElementById('feedbackMessage').value;
            
            if (!message.trim()) {
                alert('Please enter your feedback before submitting.');
                return;
            }
            
            // In a real app, this would save to Firebase
            alert('Thank you for your feedback! It has been submitted successfully.');
            feedbackModal.style.display = 'none';
            feedbackForm.reset();
        });

        // Close modals when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target === donateModal) {
                donateModal.style.display = 'none';
            }
            if (e.target === feedbackModal) {
                feedbackModal.style.display = 'none';
            }
        });

        // Set the QR code image from the data
        donateQrImage.src = sampleData.meta.donateQrUrl;

        // Navigation functionality
        document.getElementById('aboutLink').addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('aboutModal').style.display = 'flex';
        });

        document.getElementById('chaptersLink').addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('chaptersModal').style.display = 'flex';
            loadChapters();
        });

        document.getElementById('contactLink').addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('contactModal').style.display = 'flex';
        });

        // Close modal functionality
        document.querySelectorAll('.close-nav-modal').forEach(button => {
            button.addEventListener('click', (e) => {
                const modalId = e.target.dataset.modal;
                document.getElementById(modalId).style.display = 'none';
            });
        });

        // Close modal when clicking outside
        document.querySelectorAll('.nav-modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });

        // Load chapters dynamically
        function loadChapters() {
            const chaptersGrid = document.getElementById('chaptersGrid');
            const chapterTitles = [
                "Arjuna Vishada Yoga", "Sankhya Yoga", "Karma Yoga", "Jnana Yoga", 
                "Karma Vairagya Yoga", "Dhyana Yoga", "Jnana Vijnana Yoga", 
                "Aksara Brahma Yoga", "Raja Vidya Yoga", "Vibhuti Yoga", 
                "Vishvarupa Darshana Yoga", "Bhakti Yoga", "Ksetra Ksetrajna Yoga", 
                "Gunatraya Vibhaga Yoga", "Purushottama Yoga", "Daivasura Sampad Yoga", 
                "Shraddhatraya Vibhaga Yoga", "Moksha Yoga"
            ];

            chaptersGrid.innerHTML = '';
            
            for (let i = 1; i <= 18; i++) {
                const chapterCard = document.createElement('div');
                chapterCard.className = 'chapter-card';
                chapterCard.innerHTML = `
                    <div class="chapter-number">${i}</div>
                    <div class="chapter-title">${chapterTitles[i-1]}</div>
                `;
                chapterCard.addEventListener('click', () => {
                    // Show shloks for this chapter
                    showChapterShloks(i, chapterTitles[i-1]);
                });
                chaptersGrid.appendChild(chapterCard);
            }
        }

        // Show shloks for a specific chapter
        function showChapterShloks(chapterNumber, chapterTitle) {
            // In a real app, this would fetch from Firebase
            // For demo, we'll show a sample
            const shlokCount = Math.floor(Math.random() * 10) + 15; // Random number of shloks
            
            alert(`Chapter ${chapterNumber}: ${chapterTitle}\n\nThis chapter contains ${shlokCount} divine verses. In the full app, you would see all shloks here with their explanations.`);
            
            // You can implement a more detailed view here
            // For now, we'll just show an alert
        }

        // WhatsApp share function
        function shareOnWhatsApp() {
            const text = "Check out Ask Krshn - Bhagavad Gita Chatbot! üïâÔ∏è\nGet divine guidance from Lord Krishna's teachings.\n\nDownload now!";
            const url = window.location.href;
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(text + ' ' + url)}`;
            window.open(whatsappUrl, '_blank');
        }

        // PWA Installation prompt
        let deferredPrompt;
        const installPrompt = document.getElementById('installPrompt');
        const installButton = document.getElementById('installButton');
        const closeInstall = document.getElementById('closeInstall');

        // Listen for beforeinstallprompt event
        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the mini-infobar from appearing on mobile
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            // Show the install prompt
            installPrompt.style.display = 'block';
        });

        // Install button handler
        installButton.addEventListener('click', async () => {
            if (deferredPrompt) {
                // Show the install prompt
                deferredPrompt.prompt();
                // Wait for the user to respond to the prompt
                const { outcome } = await deferredPrompt.userChoice;
                // We've used the prompt, and can't use it again
                deferredPrompt = null;
                // Hide the install prompt
                installPrompt.style.display = 'none';
            }
        });

        // Close install prompt
        closeInstall.addEventListener('click', () => {
            installPrompt.style.display = 'none';
        });

        // Listen for app installed event
        window.addEventListener('appinstalled', () => {
            // Hide the install prompt
            installPrompt.style.display = 'none';
            // Clear the deferredPrompt so it can be garbage collected
            deferredPrompt = null;
            // Show success message
            alert('üéâ Thank you for installing Ask Krshn! May Lord Krishna bless you with wisdom and peace.');
        });

        // Service Worker Registration for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // Add to Home Screen functionality for iOS
        function isIOS() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        }

        function isInStandaloneMode() {
            return ('standalone' in window.navigator) && (window.navigator.standalone);
        }

        // Show iOS install instructions
        if (isIOS() && !isInStandaloneMode()) {
            setTimeout(() => {
                alert('For the best experience, tap the share button üì± and then "Add to Home Screen" to install Ask Krshn on your device!');
            }, 3000);
        }

        // Auto-focus on chat input
        window.addEventListener('load', () => {
            userInput.focus();
        });
    </script>
</body>
</html>
