<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ask Krshn - Admin Panel</title>
    <style>
        /* All CSS from the previous version remains exactly the same */
        :root {
            --bg-color: #FDF5E6; --primary-color: #FF9933; --secondary-color: #4A2E2C;
            --white: #FFFFFF; --danger: #e74c3c;
            --font-family: 'Poppins', sans-serif; --box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-family); background-color: var(--bg-color); color: var(--secondary-color); }
        #login-container { display: flex; align-items: center; justify-content: center; height: 100vh; flex-direction: column; }
        #login-form { background: var(--white); padding: 40px; border-radius: 10px; box-shadow: var(--box-shadow); width: 100%; max-width: 400px; text-align: center; }
        #login-form h1 { margin-bottom: 20px; }
        #login-form input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 5px; font-size: 1em; }
        #login-form button { width: 100%; padding: 12px; background: var(--primary-color); color: var(--white); border: none; border-radius: 5px; font-size: 1.1em; cursor: pointer; }
        #login-error { color: var(--danger); margin-top: 10px; height: 20px; }
        #admin-panel { display: none; flex-direction: column; height: 100vh; }
        header { display: flex; justify-content: space-between; align-items: center; padding: 15px 30px; background: var(--white); box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        header h1 { font-size: 1.5em; }
        #logout-btn { background: var(--danger); color: var(--white); border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; }
        main { display: flex; flex-grow: 1; overflow: hidden; }
        nav { width: 250px; background: #fffbf2; padding: 20px; overflow-y: auto; border-right: 1px solid #eee; }
        nav h3 { margin-bottom: 15px; }
        nav ul { list-style: none; }
        nav ul li a { display: block; padding: 10px 15px; text-decoration: none; color: var(--secondary-color); border-radius: 5px; margin-bottom: 5px; }
        nav ul li a.active, nav ul li a:hover { background-color: var(--primary-color); color: var(--white); }
        #content-area { flex-grow: 1; padding: 30px; overflow-y: auto; }
        #content-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .glowing-btn { background: var(--primary-color); color: var(--white); border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 1em; }
        .shlok-item { background: var(--white); padding: 15px; border-radius: 5px; margin-bottom: 15px; box-shadow: var(--box-shadow); border-left: 4px solid var(--primary-color); }
        .shlok-item h4 { margin-bottom: 10px; }
        .shlok-item blockquote { margin-bottom: 10px; font-style: italic; color: #555; }
        .shlok-actions button { margin-right: 10px; padding: 5px 10px; border: 1px solid #777; background: none; border-radius: 3px; cursor: pointer; }
        .btn-delete { border-color: var(--danger); color: var(--danger); }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
        .modal-content { background-color: #fefefe; padding: 20px; border: 1px solid #888; width: 90%; max-width: 600px; border-radius: 10px; position: relative; max-height: 90vh; overflow-y: auto; }
        .close-btn { color: #aaa; position: absolute; top: 10px; right: 20px; font-size: 28px; font-weight: bold; cursor: pointer; }
        .modal-content form label { display: block; margin-top: 15px; margin-bottom: 5px; font-weight: bold; text-align: left;}
        .modal-content form input, .modal-content form textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        .modal-content form textarea { min-height: 100px; resize: vertical; }
        #toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: #333; color: white; padding: 15px 25px; border-radius: 5px; opacity: 0; visibility: hidden; transition: opacity 0.5s, visibility 0.5s; z-index: 2000; }
        #toast.show { opacity: 1; visibility: visible; }
        .feedback-item { background: var(--white); padding: 15px; border-radius: 5px; margin-bottom: 15px; box-shadow: var(--box-shadow); border-left: 4px solid #3498db; }
        .settings-form input, .chapter-desc-form textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; margin-top: 10px; }
    </style>
</head>
<body>
    <!-- Login Page and main panel structure are the same -->
    <div id="login-container">
        <form id="login-form"><h1>Admin Login</h1><input type="email" id="email" placeholder="Email" required><input type="password" id="password" placeholder="Password" required><button type="submit">Login</button><p id="login-error"></p></form>
    </div>
    <div id="admin-panel">
        <header><h1>Ask Krshn - Dashboard</h1><button id="logout-btn">Logout</button></header>
        <main>
            <nav>
                <h3>Management</h3>
                <ul>
                    <li><a href="#" class="nav-link" data-content="settings">Settings</a></li>
                    <li><a href="#" class="nav-link" data-content="greetings">Custom Greetings</a></li>
                    <li><a href="#" class="nav-link" data-content="feedback">View Feedback</a></li>
                </ul><hr style="margin: 20px 0;">
                <h3>Content</h3>
                <ul>
                    <!-- NEW: Chapter Descriptions Link -->
                    <li><a href="#" class="nav-link" data-content="chapter_descriptions">Chapter Descriptions</a></li>
                </ul>
                <hr style="margin: 20px 0;">
                <h3>Chapters (Shloks)</h3>
                <ul id="chapters-nav"></ul>
            </nav>
            <section id="content-area">
                <div id="content-header"><h2 id="content-title">Welcome</h2></div>
                <div id="content-body"><p>Select an option from the left to begin.</p></div>
            </section>
        </main>
    </div>
    <!-- All modals are the same as before -->
    <div id="shlok-modal" class="modal"> <div class="modal-content"> <span class="close-btn" data-modal="shlok-modal">&times;</span> <h2 id="modal-title">Add Shlok</h2> <form id="shlok-form"> <input type="hidden" id="shlok-id"> <label for="chapter-no">Chapter Number</label> <input type="number" id="chapter-no" min="1" max="18" required readonly> <label for="verse-no">Verse Number</label> <input type="number" id="verse-no" min="1" required> <label for="shlok-text">Sanskrit Shlok</label> <textarea id="shlok-text" rows="3" required></textarea> <label for="shlok-explanation-hin">Explanation (Hinglish / Hindi)</label> <textarea id="shlok-explanation-hin" rows="4" required></textarea> <label for="shlok-explanation-eng">Explanation (English)</label> <textarea id="shlok-explanation-eng" rows="4" required></textarea> <button type="submit" class="glowing-btn" style="margin-top: 20px;">Save Shlok</button> </form> </div> </div>
    <div id="greeting-modal" class="modal"> <div class="modal-content"><span class="close-btn" data-modal="greeting-modal">&times;</span><h2 id="greeting-modal-title">Add Greeting</h2><form id="greeting-form"><input type="hidden" id="greeting-id"><label for="greeting-trigger">User Says (Trigger)</label><input type="text" id="greeting-trigger" placeholder="e.g., Radhe Radhe" required><label for="greeting-reply">Bot Replies</label><textarea id="greeting-reply" rows="3" placeholder="e.g., Radhe Radhe! May your day be blessed." required></textarea><button type="submit" class="glowing-btn" style="margin-top: 20px;">Save Greeting</button></form></div> </div>
    <div id="toast"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getDatabase, ref, set, get, remove, push, child } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";

        const firebaseConfig = {
  apiKey: "AIzaSyCqQqJWMl3naW8Ad8_lpoFQyuzSjTJs8N8",
  authDomain: "skater-13f74.firebaseapp.com",
  databaseURL: "https://skater-13f74-default-rtdb.firebaseio.com",
  projectId: "skater-13f74",
  storageBucket: "skater-13f74.firebasestorage.app",
  messagingSenderId: "750747470830",
  appId: "1:750747470830:web:2deefa64a23e45d3ae9cff"
};
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        // All DOM elements are the same
        const loginContainer = document.getElementById('login-container');
        const adminPanel = document.getElementById('admin-panel');
        const loginForm = document.getElementById('login-form');
        const logoutBtn = document.getElementById('logout-btn');
        const chaptersNav = document.getElementById('chapters-nav');
        const contentHeader = document.getElementById('content-header');
        const contentBody = document.getElementById('content-body');
        const shlokModal = document.getElementById('shlok-modal');
        const shlokForm = document.getElementById('shlok-form');
        const greetingModal = document.getElementById('greeting-modal');
        let currentChapter = null;
        
        // --- initAdminPanel is UPGRADED ---
        function initAdminPanel() {
            chaptersNav.innerHTML = '';
            for (let i = 1; i <= 18; i++) {
                const li = document.createElement('li');
                li.innerHTML = `<a href="#" class="nav-link" data-content="chapter" data-chapter="${i}">Chapter ${i}</a>`;
                chaptersNav.appendChild(li);
            }
            
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    e.target.classList.add('active');
                    
                    const contentType = e.target.dataset.content;
                    if (contentType === 'chapter') {
                        currentChapter = e.target.dataset.chapter;
                        loadChapterContent(currentChapter);
                    } else if (contentType === 'chapter_descriptions') { // NEW
                        loadChapterDescriptions();
                    } else if (contentType === 'feedback') {
                        loadFeedbackContent();
                    } else if (contentType === 'settings') {
                        loadSettingsContent();
                    } else if (contentType === 'greetings') {
                        loadGreetingsContent();
                    }
                });
            });
        }

        // --- NEW FUNCTION: To load and save chapter descriptions ---
        async function loadChapterDescriptions() {
            resetContentArea('Chapter Descriptions');
            contentBody.innerHTML = `<p>Loading descriptions...</p>`;
            try {
                const snapshot = await get(ref(db, 'meta/chapter_descriptions'));
                const descriptions = snapshot.exists() ? snapshot.val() : {};
                
                let formHtml = `<div class="chapter-desc-form">`;
                for (let i = 1; i <= 18; i++) {
                    formHtml += `
                        <label for="chap-desc-${i}"><b>Chapter ${i} Summary</b></label>
                        <textarea id="chap-desc-${i}" rows="2" placeholder="Summary of Chapter ${i}...">${descriptions[`chapter_${i}`] || ''}</textarea>
                    `;
                }
                formHtml += `<button id="save-descriptions-btn" class="glowing-btn" style="margin-top:20px;">Save All Descriptions</button></div>`;
                contentBody.innerHTML = formHtml;
                
                document.getElementById('save-descriptions-btn').addEventListener('click', async () => {
                    const updates = {};
                    for (let i = 1; i <= 18; i++) {
                        const desc = document.getElementById(`chap-desc-${i}`).value.trim();
                        if(desc) updates[`chapter_${i}`] = desc;
                    }
                    await set(ref(db, 'meta/chapter_descriptions'), updates);
                    showToast("Chapter descriptions saved successfully!");
                });
            } catch (error) {
                contentBody.innerHTML = '<p>Error loading chapter descriptions.</p>';
            }
        }

        // All other JS functions remain the same as the last version
        // No need to copy them again, just ensure they are present in your file.
        // This includes: showToast, onAuthStateChanged, login logic, shlok management (with dual explanations), greetings management, etc.
        function showToast(message, type = 'success') { const toast = document.getElementById('toast'); toast.textContent = message; toast.style.backgroundColor = type === 'error' ? '#e74c3c' : '#333'; toast.classList.add('show'); setTimeout(() => { toast.classList.remove('show'); }, 3000); }
        onAuthStateChanged(auth, user => { if (user) { loginContainer.style.display = 'none'; adminPanel.style.display = 'flex'; initAdminPanel(); } else { loginContainer.style.display = 'flex'; adminPanel.style.display = 'none'; } });
        loginForm.addEventListener('submit', (e) => { e.preventDefault(); const email = loginForm.email.value; const password = loginForm.password.value; signInWithEmailAndPassword(auth, email, password).catch(error => { document.getElementById('login-error').textContent = error.message; }); });
        logoutBtn.addEventListener('click', () => signOut(auth));
        function resetContentArea(title) { document.getElementById('content-title').textContent = title; contentHeader.innerHTML = `<h2 id="content-title">${title}</h2>`; contentBody.innerHTML = '<p>Loading...</p>'; }
        async function loadSettingsContent() { resetContentArea('General Settings'); try { const snapshot = await get(ref(db, 'meta')); const currentQrUrl = snapshot.exists() && snapshot.val().donateQrUrl ? snapshot.val().donateQrUrl : ''; contentBody.innerHTML = ` <div class="settings-form"> <h3>Donation Settings</h3> <p>Enter the full URL of your UPI QR code image.</p> <input type="url" id="donate-qr-url-input" value="${currentQrUrl}" placeholder="https://i.postimg.cc/your-qr-code.png"> <button id="save-settings-btn" class="glowing-btn" style="margin-top: 15px;">Save Settings</button> </div>`; document.getElementById('save-settings-btn').addEventListener('click', async () => { const newUrl = document.getElementById('donate-qr-url-input').value.trim(); if (newUrl) { await set(ref(db, 'meta/donateQrUrl'), newUrl); showToast("Settings saved!"); } else { showToast("URL cannot be empty.", "error"); } }); } catch(error) { contentBody.innerHTML = '<p>Error loading settings.</p>'; } }
        async function loadFeedbackContent() { resetContentArea('User Feedback'); try { const snapshot = await get(ref(db, 'feedback')); if (!snapshot.exists()) { contentBody.innerHTML = '<p>No feedback received yet.</p>'; return; } const feedbackData = snapshot.val(); let html = '<h3>All User Suggestions</h3>'; const sortedKeys = Object.keys(feedbackData).reverse(); for (const key of sortedKeys) { const feedback = feedbackData[key]; html += ` <div class="feedback-item"> <p>"${feedback.feedback}"</p> <small>Received on: ${new Date(feedback.timestamp).toLocaleString()}</small> </div>`; } contentBody.innerHTML = html; } catch(error) { contentBody.innerHTML = '<p>Error loading feedback data.</p>'; } }
        async function loadGreetingsContent() { contentHeader.innerHTML = `<h2 id="content-title">Custom Greetings</h2><button id="add-greeting-btn" class="glowing-btn">+ Add New Greeting</button>`; document.getElementById('add-greeting-btn').addEventListener('click', () => openGreetingModal()); contentBody.innerHTML = '<p>Loading...</p>'; try { const snapshot = await get(ref(db, 'greetings')); if (!snapshot.exists()) { contentBody.innerHTML = '<p>No custom greetings found.</p>'; return; } const greetings = snapshot.val(); let html = ''; for (const key in greetings) { const g = greetings[key]; html += ` <div class="shlok-item"> <h4>Trigger: "${g.trigger}"</h4> <p>Reply: "${g.reply}"</p> <div class="shlok-actions"> <button class="btn-edit-greeting" data-key="${key}">Edit</button> <button class="btn-delete-greeting" data-key="${key}">Delete</button> </div> </div>`; } contentBody.innerHTML = html; document.querySelectorAll('.btn-edit-greeting').forEach(btn => btn.addEventListener('click', (e) => openGreetingModal(e.target.dataset.key, greetings[e.target.dataset.key]))); document.querySelectorAll('.btn-delete-greeting').forEach(btn => btn.addEventListener('click', (e) => deleteGreeting(e.target.dataset.key))); } catch(error) { contentBody.innerHTML = '<p>Error loading greetings.</p>'; } }
        function openGreetingModal(key = null, data = null) { const form = document.getElementById('greeting-form'); form.reset(); document.getElementById('greeting-modal-title').textContent = key ? 'Edit Greeting' : 'Add Greeting'; document.getElementById('greeting-id').value = key || ''; if (data) { document.getElementById('greeting-trigger').value = data.trigger; document.getElementById('greeting-reply').value = data.reply; } greetingModal.style.display = 'flex'; }
        document.getElementById('greeting-form').addEventListener('submit', async (e) => { e.preventDefault(); const key = document.getElementById('greeting-id').value; const data = { trigger: document.getElementById('greeting-trigger').value.trim(), reply: document.getElementById('greeting-reply').value.trim(), }; if (!data.trigger || !data.reply) { showToast("Both fields are required.", "error"); return; } const dbRef = key ? child(ref(db, 'greetings'), key) : push(ref(db, 'greetings')); await set(dbRef, data); showToast("Greeting saved!"); greetingModal.style.display = 'none'; loadGreetingsContent(); });
        async function deleteGreeting(key) { if (confirm('Are you sure?')) { await remove(ref(db, `greetings/${key}`)); showToast("Greeting deleted."); loadGreetingsContent(); } }
        async function loadChapterContent(chapter) { contentHeader.innerHTML = `<h2 id="content-title">Chapter ${chapter}</h2><button id="add-shlok-btn" class="glowing-btn">+ Add New Shlok</button>`; document.getElementById('add-shlok-btn').addEventListener('click', () => openShlokModal()); contentBody.innerHTML = '<p>Loading...</p>'; try { const snapshot = await get(ref(db, `shloks/chapter_${chapter}`)); if (!snapshot.exists()) { contentBody.innerHTML = '<p>No shloks found for this chapter.</p>'; return; } renderShloks(snapshot.val()); } catch (error) { contentBody.innerHTML = '<p>Error loading data.</p>'; } }
        function renderShloks(shloks) { contentBody.innerHTML = ''; const sortedVerses = Object.keys(shloks).sort((a, b) => parseInt(a.replace('verse_', '')) - parseInt(b.replace('verse_', ''))); sortedVerses.forEach(verseKey => { const shlok = shloks[verseKey]; const div = document.createElement('div'); div.className = 'shlok-item'; div.innerHTML = ` <h4>Verse ${verseKey.replace('verse_', '')}</h4> <blockquote>${shlok.shlok}</blockquote> <p><b>Hinglish:</b> ${shlok.explanation_hin || 'Not provided.'}</p> <p><b>English:</b> ${shlok.explanation_eng || 'Not provided.'}</p> <div class="shlok-actions"> <button class="btn-edit" data-verse="${verseKey}">Edit</button> <button class="btn-delete" data-verse="${verseKey}">Delete</button> </div>`; contentBody.appendChild(div); }); document.querySelectorAll('.btn-edit').forEach(btn => btn.addEventListener('click', (e) => openShlokModal(e.target.dataset.verse, shloks[e.target.dataset.verse]))); document.querySelectorAll('.btn-delete').forEach(btn => btn.addEventListener('click', (e) => deleteShlok(e.target.dataset.verse))); }
        function openShlokModal(verseKey = null, shlokData = null) { shlokForm.reset(); document.getElementById('chapter-no').value = currentChapter; document.getElementById('modal-title').textContent = verseKey ? 'Edit Shlok' : 'Add Shlok'; document.getElementById('shlok-id').value = verseKey || ''; document.getElementById('verse-no').readOnly = !!verseKey; if (shlokData) { document.getElementById('verse-no').value = verseKey.replace('verse_', ''); document.getElementById('shlok-text').value = shlokData.shlok; document.getElementById('shlok-explanation-hin').value = shlokData.explanation_hin || ''; document.getElementById('shlok-explanation-eng').value = shlokData.explanation_eng || ''; } shlokModal.style.display = 'flex'; }
        shlokForm.addEventListener('submit', async (e) => { e.preventDefault(); const verseNum = document.getElementById('verse-no').value; const verseKey = document.getElementById('shlok-id').value || `verse_${verseNum}`; const shlokData = { shlok: document.getElementById('shlok-text').value, explanation_hin: document.getElementById('shlok-explanation-hin').value, explanation_eng: document.getElementById('shlok-explanation-eng').value, createdAt: new Date().toISOString() }; if (!shlokData.shlok || !shlokData.explanation_hin || !shlokData.explanation_eng) { showToast("All fields are required.", "error"); return; } await set(ref(db, `shloks/chapter_${currentChapter}/${verseKey}`), shlokData); showToast("Shlok saved!"); shlokModal.style.display = 'none'; loadChapterContent(currentChapter); });
        async function deleteShlok(verseKey) { if (confirm(`Are you sure you want to delete this verse?`)) { await remove(ref(db, `shloks/chapter_${currentChapter}/${verseKey}`)); showToast("Shlok deleted."); loadChapterContent(currentChapter); } }
        document.querySelectorAll('.close-btn').forEach(btn => { btn.addEventListener('click', () => { document.getElementById(btn.dataset.modal).style.display = 'none'; }); });
    </script>
</body>
</html>
